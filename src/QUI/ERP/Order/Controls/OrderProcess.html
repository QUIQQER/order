{if $CurrentStep->hasOwnForm() === false}
<form name="order"
      action=""
      method="post"
      data-products-count="{if $Order}{$Order->count()}{/if}"
      data-order-hash="{$this->getAttribute('orderHash')}"
>
{else}
    <div name="order"
          data-action=""
          data-method="post"
          data-products-count="{if $Order}{$Order->count()}{/if}"
          data-order-hash="{$this->getAttribute('orderHash')}"
    >
{/if}
    <div class="quiqqer-order-ordering-timeline">
        <ul>
            {strip}
            {assign var=cssClass value="active"}
            {foreach $steps as $step => $Step}
                {if $CurrentStep == $Step}
                    {assign var=cssClass value="current"}
                {/if}

                <li style="width: {$listWidth}%;" class="{$cssClass}"
                    data-step="{$Step->getName()}"
                    data-icon="{$Step->getIcon()}"
                >
                {if $Step->getName() === 'finish'}
                    <span class="title">{$Step->getTitle()}</span>
                    <span class="fa fa-check-circle"></span>
                {else if}
                    <a href="{$this->getStepUrl($step)}">
                        <span class="title">{$Step->getTitle()}</span>
                        <span class="fa fa-check-circle"></span>
                    </a>
                {/if}
                </li>

                {if $CurrentStep == $Step}
                    {assign var=cssClass value=""}
                {/if}
            {/foreach}
            {strip}
        </ul>
    </div>

    {if $error}
    <div class="quiqqer-order-ordering-error">
        {$error}
    </div>
    {/if}

    <div class="quiqqer-order-ordering-step">
        {$currentStepContent}
    </div>

    <div class="quiqqer-order-ordering-buttons">
        <a href="{url id=1}" class="button">
            {locale group="quiqqer/order" var="ordering.btn.backToShop"}
        </a>

        {if $previous}
        <a href="{$this->getStepUrl($previous)}"
           class="button quiqqer-order-ordering-buttons-previous"
        >
            {locale group="quiqqer/order" var="ordering.btn.previous"}
        </a>
        {/if}

        {if $payableToOrder}
        <button name="step" value="payableToOrder" class="button quiqqer-order-ordering-buttons-next">
            {locale group="quiqqer/order" var="ordering.btn.pay.to.order"}
        </button>
        {else if $next}
        <button name="step" value="{$next}" class="button quiqqer-order-ordering-buttons-next">
            {locale group="quiqqer/order" var="ordering.btn.next"}
        </button>
        {/if}
    </div>

    <input type="hidden" name="pre" value="{$previous}"/>
    <input type="hidden" name="current" value="{$CurrentStep->getName()}"/>

    {if $Order}
    <input type="hidden" name="orderId" value="{$Order->getId()}"/>
    {/if}

{if $CurrentStep->hasOwnForm()}
</div>
{else}
</form>
{/if}